{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-info" style="font-family: 'Orbitron', sans-serif;">
            <i class="bi bi-map me-2"></i>TACTICAL PLANNING
        </h2>
        <p class="text-muted">Mission Timeline & Sector Overview.</p>
    </div>
</div>

<div class="row mb-5">
    <div class="col-12">
        <div class="card bg-dark border-info shadow-lg">
            <div class="card-header border-info bg-transparent">
                <h5 class="text-white mb-0"><i class="bi bi-activity me-2"></i>WORKLOAD PROJECTION</h5>
            </div>
            <div class="card-body">
                <canvas id="planningChart" style="max-height: 250px;"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-5 mb-4">
        <h4 class="text-white mb-3" style="font-family: 'Orbitron', sans-serif;">
            <i class="bi bi-calendar-event me-2"></i>TIMELINE
        </h4>
        
        {% if scheduled %}
            <div class="list-group">
                {% for habit in scheduled %}
                <div class="list-group-item bg-dark border-secondary text-white mb-2 rounded shadow-sm d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-info fw-bold small mb-1">
                            {{ habit.target_date.strftime('%a, %b %d') }}
                        </div>
                        <span class="{{ 'text-decoration-line-through text-muted' if habit.completed else '' }}">
                            {{ habit.name }}
                        </span>
                        <div class="small text-muted mt-1">
                            Sector: {{ habit.goal.name }}
                        </div>
                    </div>
                    <span class="badge {{ 'bg-success' if habit.difficulty == 'Easy' else 'bg-warning' if habit.difficulty == 'Medium' else 'bg-danger' }}">
                        {{ habit.difficulty }}
                    </span>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-secondary bg-dark border-secondary text-muted text-center">
                No scheduled operations detected.
            </div>
        {% endif %}
    </div>

    <div class="col-md-7">
        <h4 class="text-white mb-3" style="font-family: 'Orbitron', sans-serif;">
            <i class="bi bi-grid-3x3-gap me-2"></i>SECTOR OVERVIEW
        </h4>
        
        {% for goal in goals %}
        <div class="card bg-dark border-secondary mb-3">
            <div class="card-header border-secondary bg-transparent d-flex justify-content-between">
                <span class="text-white fw-bold">{{ goal.name }}</span>
                <span class="badge bg-secondary">{{ goal.habits|length }} Units</span>
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush">
                    {% for habit in goal.habits %}
                    <li class="list-group-item bg-transparent border-secondary text-white d-flex justify-content-between align-items-center">
                        <span class="small {{ 'text-muted' if habit.completed }}">
                            {{ habit.name }}
                        </span>
                        
                        {% if habit.target_date %}
                            <span class="badge bg-info bg-opacity-10 text-info border border-info" style="font-size: 0.6em;">
                                {{ habit.target_date.strftime('%m-%d') }}
                            </span>
                        {% else %}
                            <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary" style="font-size: 0.6em;">
                                Unscheduled
                            </span>
                        {% endif %}
                    </li>
                    {% endfor %}
                    {% if not goal.habits %}
                    <li class="list-group-item bg-transparent text-muted small text-center py-3">Empty Sector</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const ctx = document.getElementById('planningChart').getContext('2d');
        
        // Data passed from Python
        const labels = {{ chart_labels | tojson }};
        const data = {{ chart_data | tojson }};

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Active Missions',
                    data: data,
                    backgroundColor: 'rgba(0, 243, 255, 0.2)', // Neon Blue
                    borderColor: 'rgba(0, 243, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { color: '#888' }, grid: { color: '#333' } },
                    x: { ticks: { color: '#888' }, grid: { display: false } }
                },
                plugins: {
                    legend: { labels: { color: '#fff' } }
                }
            }
        });
    });
</script>
{% endblock %}