{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <div>
            <h2 class="text-white" style="font-family: 'Orbitron', sans-serif;">
                <i class="bi bi-clipboard-check me-2"></i>OPERATIONS AUDIT
            </h2>
            <p class="text-muted">Review and process overdue directives.</p>
        </div>
        <div class="text-end">
            <h1 class="display-4 text-danger fw-bold mb-0">{{ tasks|length }}</h1>
            <span class="text-uppercase text-muted small">Overdue Items</span>
        </div>
    </div>
</div>

<form action="{{ url_for('process_audit') }}" method="POST">
    <div class="card bg-dark border-secondary shadow-lg">
        <div class="card-header border-secondary bg-transparent py-3">
            <div class="d-flex gap-2 justify-content-end align-items-center">
                <span class="text-muted me-auto small">
                    <i class="bi bi-check-all me-1"></i> Select items to process
                </span>
                
                <button type="submit" name="action" value="move_today" class="btn btn-sm btn-outline-info">
                    <i class="bi bi-calendar-event"></i> Today
                </button>
                <button type="submit" name="action" value="move_tomorrow" class="btn btn-sm btn-outline-light">
                    <i class="bi bi-arrow-right"></i> +1 Day
                </button>
                <button type="submit" name="action" value="deprioritize" class="btn btn-sm btn-outline-warning">
                    <i class="bi bi-archive"></i> Unschedule
                </button>
                <button type="submit" name="action" value="delete" class="btn btn-sm btn-outline-danger" onclick="return confirm('Permanently terminate selected tasks?');">
                    <i class="bi bi-trash"></i> Delete
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-dark table-hover mb-0" style="vertical-align: middle;">
                <thead>
                    <tr class="text-muted small text-uppercase">
                        <th style="width: 50px;" class="ps-4">
                            <input class="form-check-input bg-dark border-secondary" type="checkbox" onclick="toggleAll(this)">
                        </th>
                        <th>Directive</th>
                        <th>Due Date</th>
                        <th>Sector</th>
                        <th class="text-end pe-4">Priority</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr>
                        <td class="ps-4">
                            <input class="form-check-input bg-dark border-secondary task-check" type="checkbox" name="task_ids" value="{{ task.id }}">
                        </td>
                        <td class="fw-bold text-white">
                            {{ task.name }}
                        </td>
                        <td class="text-danger">
                            {{ task.target_date.strftime('%b %d') }}
                        </td>
                        <td>
                            <span class="badge bg-dark border border-secondary text-muted">
                                {{ task.goal.name }}
                            </span>
                        </td>
                        <td class="text-end pe-4">
                            <span class="badge 
                                {% if task.difficulty == 'Easy' %}text-success border-success
                                {% elif task.difficulty == 'Medium' %}text-warning border-warning
                                {% else %}text-danger border-danger{% endif %} bg-transparent border">
                                {{ task.difficulty }}
                            </span>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">
                            <i class="bi bi-shield-check fs-1 mb-3 d-block text-success"></i>
                            <h5 class="text-white">Backlog Clear</h5>
                            <p class="mb-0">All systems nominal. No overdue operations.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</form>

<script>
    function toggleAll(source) {
        checkboxes = document.getElementsByClassName('task-check');
        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;
        }
    }
</script>
{% endblock %}