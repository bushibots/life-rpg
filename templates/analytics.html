{% extends "base.html" %}

{% block content %}
<div class="row g-4 mb-4">
    <div class="col-12">
        <h2 class="text-info" style="font-family: 'Orbitron', sans-serif; letter-spacing: 2px;">
            <i class="bi bi-crosshair me-2"></i>TACTICAL ANALYTICS
        </h2>
        <p class="text-muted small">Real-time performance metrics and attribute distribution.</p>
    </div>
</div>

<div class="row g-4">
    
    <div class="col-md-5 col-12">
        <div class="card h-100 bg-dark shadow-lg" style="border: 1px solid var(--neon-purple); background: rgba(10, 10, 15, 0.9);">
            <div class="card-header border-0 bg-transparent text-center">
                <h5 class="text-white mb-0" style="font-family: 'Orbitron', sans-serif;">ATTRIBUTE BALANCE</h5>
            </div>
            <div class="card-body position-relative">
                <div style="height: 300px; position: relative;">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-7 col-12">
        <div class="card h-100 bg-dark shadow-lg" style="border: 1px solid var(--neon-blue); background: rgba(10, 10, 15, 0.9);">
            <div class="card-header border-0 bg-transparent text-center">
                <h5 class="text-white mb-0" style="font-family: 'Orbitron', sans-serif;">XP VELOCITY (7 DAYS)</h5>
            </div>
            <div class="card-body position-relative">
                <div style="height: 300px; position: relative;">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card h-100 bg-dark shadow-lg" style="border: 1px solid var(--neon-green); background: rgba(10, 10, 15, 0.9);">
            <div class="card-header border-0 bg-transparent text-center">
                <h5 class="text-white mb-0" style="font-family: 'Orbitron', sans-serif;">MISSION DIFFICULTY SPREAD</h5>
            </div>
            <div class="card-body position-relative">
                <div style="height: 300px; position: relative;">
                    <canvas id="polarChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- MOBILE DETECTION ---
    const isMobile = window.innerWidth < 768;
    
    // --- GLOBAL CHART DEFAULTS ---
    Chart.defaults.color = '#94a3b8';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.05)';
    Chart.defaults.font.family = "'Segoe UI', sans-serif";
    Chart.defaults.font.size = isMobile ? 11 : 12; // Smaller font on mobile

    // 1. RADAR CHART
    new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
            labels: {{ radar_labels | tojson }}, 
            datasets: [{
                label: 'Attribute Balance',
                data: {{ radar_data | tojson }},
                backgroundColor: 'rgba(188, 19, 254, 0.2)',
                borderColor: '#bc13fe',
                pointBackgroundColor: '#fff',
                pointBorderColor: '#bc13fe',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#bc13fe'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // Allows chart to fill the 300px container
            scales: {
                r: {
                    angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    pointLabels: { 
                        color: '#fff',
                        font: { size: isMobile ? 10 : 12 }
                    },
                    ticks: { display: false, backdropColor: 'transparent' }
                }
            },
            plugins: { legend: { display: false } }
        }
    });

    // 2. LINE CHART (Velocity)
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: {{ trend_dates | tojson }},
            datasets: [{
                label: 'XP Gained',
                data: {{ trend_data | tojson }},
                borderColor: '#00f2ff', // Neon Blue
                backgroundColor: 'rgba(0, 242, 255, 0.1)',
                tension: 0.4, 
                fill: true,
                pointRadius: isMobile ? 3 : 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { 
                    beginAtZero: true,
                    ticks: { display: !isMobile } // Hide Y-axis numbers on mobile to save space
                },
                x: {
                    ticks: { maxTicksLimit: isMobile ? 4 : 7 } // Fewer dates on mobile
                }
            }
        }
    });

    // 3. POLAR AREA CHART
    new Chart(document.getElementById('polarChart'), {
        type: 'polarArea',
        data: {
            labels: ['Easy', 'Medium', 'Hard', 'Epic'],
            datasets: [{
                data: {{ diff_data | tojson }},
                backgroundColor: [
                    'rgba(10, 255, 104, 0.6)', // Green
                    'rgba(0, 242, 255, 0.6)', // Blue
                    'rgba(255, 215, 0, 0.6)',  // Gold
                    'rgba(255, 0, 60, 0.6)'    // Red
                ],
                borderWidth: 1,
                borderColor: '#111'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    ticks: { display: false, backdropColor: 'transparent' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#fff', boxWidth: 10, padding: 20 }
                }
            }
        }
    });
</script>
{% endblock %}